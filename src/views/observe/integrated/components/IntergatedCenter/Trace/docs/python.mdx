import Alert from '@/views/observe/integrated/components/IntergatedCenter/Alert';

<Alert message="在使用前请联系集群管理员开启 KubeGems Observability 相关的组件。" />

## KubeGems OpenTelemetry Collector

修改应用 SDK 中的 Exporter Endpoint 地址为 opentelemetry-collector.observability: `<port>`。 其中， opentelemetry-collector 是 Collector 的 Service 名称，observability 是 Collector 所在命名空间，不同上报协议对应端口如下:

| Receivers |  Protocols  | Port  |
| :-------: | :---------: | :---: |
|   otlp    |    gRPC     | 4317  |
|   otlp    |    http     | 4318  |
|  jaeger   |    gRPC     | 14250 |
|  jaeger   | thrift_http | 14268 |
|  zipkin   |             | 9411  |

## Python 应用接入

Opentelmetry 为 Python 提供了自动化的检测和埋点。这种方法简单、容易，并且不需要很多代码更改。只需要安装几个 Python 包即可成功检测应用程序的代码

#### step 1 安装 opentelmetry 相关的库

```python
$ pip install opentelemetry-distro
$ pip install opentelemetry-instrumentation-flask
$ pip install flask
$ pip install requests
```

#### step 2 执行自动检测

```
$ opentelemetry-instrument --traces_exporter otlp  python  your-pythonApp
```

#### step 3 配置 OTLP Exporter

```
$ pip install opentelemetry-exporter-otlp-proto-http
```

通过下列代码初始化 trace

```python
from opentelemetry import trace
from opentelemetry.exporter.otlp.proto.http.trace_exporter import OTLPSpanExporter
from opentelemetry.sdk.resources import SERVICE_NAME, Resource
from opentelemetry.sdk.trace import TracerProvider
from opentelemetry.sdk.trace.export import BatchSpanProcessor

# Service name is required for most backends
resource = Resource(attributes={
    SERVICE_NAME: "your-pythonApp"
})

provider = TracerProvider(resource=resource)
processor = BatchSpanProcessor(OTLPSpanExporter(endpoint="opentelemetry-collector.observability:4318"))
provider.add_span_processor(processor)
trace.set_tracer_provider(provider)
```

更多信息请参考[opentelemetry/python](https://opentelemetry.io/docs/instrumentation/python/getting-started/)
